!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.rum=e():t.rum=e()}(window,function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=6)}([function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return i(t,null,[{key:"VERSION",get:function(){return"1.0.13"}},{key:"PING_INTERVAL",get:function(){return 2e4}},{key:"SENT_TIMEOUT",get:function(){return 2e4}},{key:"RESET_OPENEVENT_INTERVAL",get:function(){return 18e5}},{key:"RESET_OPENEVENT_INTERVAL_MOBILE",get:function(){return 6e4}},{key:"EVENT_QUEUE_LIMIT",get:function(){return 1e3}},{key:"STORAGE_SIZE_LIMIT",get:function(){return 2097152}},{key:"LOCAL_STORAGE_DELAY",get:function(){return 1e3}},{key:"SENT_SIZE_LIMIT",get:function(){return 15360}}]),t}();t.exports=r},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._ua=UAParser()}return i(t,[{key:"setItem",value:function(t,e){var n=null;try{n=JSON.stringify(e)}catch(t){n=e}try{localStorage.setItem(t,n)}catch(t){return!1}return!0}},{key:"getItem",value:function(t){var e=null,n=null;try{n=localStorage.getItem(t)}catch(t){}n||(n={});try{e=JSON.parse(n)}catch(t){e=n}return e}},{key:"removeItem",value:function(t){if(localStorage&&localStorage.hasOwnProperty(t))try{return localStorage.removeItem(t),!0}catch(t){}return!1}},{key:"httpRequest",value:function(t,e){(function(t,e){var n=new XMLHttpRequest;n&&(n.open("GET",t,!0),n.onload=function(){var t=JSON.parse(n.responseText);4==n.readyState&&"200"==n.status&&e&&e(null,t)},n.send(null))}).call(this,t,e)}},{key:"addSelfListener",value:function(){(function(){var t=this,e=void 0,n=void 0;void 0!==document.hidden?(e="hidden",n="visibilitychange","visibilityState"):void 0!==document.mozHidden?(e="mozHidden",n="mozvisibilitychange","mozVisibilityState"):void 0!==document.msHidden?(e="msHidden",n="msvisibilitychange","msVisibilityState"):void 0!==document.webkitHidden&&(e="webkitHidden",n="webkitvisibilitychange","webkitVisibilityState");document.addEventListener(n,function(){t.emit("visible_change",!document[e])},!1)}).call(this)}},{key:"lang",get:function(){return navigator.language}},{key:"manu",get:function(){return this._ua.device.vendor||navigator.vendor}},{key:"model",get:function(){return this._ua.device.model||this._ua.browser.name}},{key:"os",get:function(){return this._ua.os.name}},{key:"osv",get:function(){return this._ua.os.version}},{key:"network",get:function(){return navigator.connection&&navigator.connection.effectiveType}},{key:"isMobile",get:function(){return"mobile"===this._ua.device.type}},{key:"screenheight",get:function(){return screen.height}},{key:"screenwidth",get:function(){return screen.width}},{key:"carrier",get:function(){return null}},{key:"from",get:function(){return null}},{key:"tickNow",get:function(){return function(){return Date.now()}.call(this)}}]),t}();t.exports=r},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=n(0),o="event_cache",s="event_map_0",a="event_map_1",u="event_map_2",l="event_map_3",c={1:["crash","error","nwswitch","open","warn","append"]},h=function(){function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._rumId=null,this._events=null,this._isFirst=!1,this._config=c,this._hasConf=!1,this._debug=i,this._timestamp=0,this._secondInterval=0,this._delayCount=0,this._platformRum=n,this._rum_id_storage="rum_rid_"+e,this._rum_events_storage="rum_events_"+e,this._storageSize=0,this._storageTimeout=0,this._sizeLimit=r.SENT_SIZE_LIMIT,function(){this._events=this._platformRum.getItem(this._rum_events_storage),function t(){var e=this;this._storageSize=d.call(this,JSON.stringify(this._events));var n=r.LOCAL_STORAGE_DELAY*Math.ceil(this._storageSize/this._sizeLimit);this._storageSize>r.STORAGE_SIZE_LIMIT?this._platformRum.setItem(this._rum_events_storage,{}):this._platformRum.setItem(this._rum_events_storage,this._events);this._storageTimeout&&(clearTimeout(this._storageTimeout),this._storageTimeout=0);this._storageTimeout=setTimeout(function(){t.call(e)},n)}.call(this)}.call(this),y.call(this)}return i(t,[{key:"updateConfig",value:function(t){this._config=t,this._hasConf=!0;var e=f.call(this,s);for(var n in e){var i=p.call(this,n);if(i){var r=f.call(this,i);r[n]?r[n]=e[n].concat(r[n]):r[n]=e[n]}else this._debug&&console.log("[RUM] disable event & will be discard!",e[n]);delete e[n]}m.call(this,s,e);var a=f.call(this,o);if(!g.call(this,a))for(var u in a)this.writeEvent(a[u]);m.call(this,o,{})}},{key:"writeEvent",value:function(t,e){var n=t.ev,i=p.call(this,n);if(i){var o=f.call(this,i);o[n]||(o[n]=[]),o[n].length>=r.EVENT_QUEUE_LIMIT&&(this._debug&&console.log("[RUM] event(normal) queue limit & will be shift!",t),o[n].shift()),o[n].push(t),m.call(this,i,o)}else this._debug&&console.log("[RUM] disable event & will be discard!",n);e&&this._platformRum.setItem(this._rum_events_storage,this._events)}},{key:"writeEvents",value:function(t){for(var e in t)this.writeEvent(t[e])}},{key:"clearStorage",value:function(){this._events={},this._platformRum.setItem(this._rum_events_storage,{})}},{key:"removeFromCache",value:function(t){var e=f.call(this,o);for(var n in t)delete e[t[n].eid];m.call(this,o,e)}},{key:"getSentEvents",value:function(){var t={size:0,events:[]};return v.call(this,t,a),t.size>=this._sizeLimit?t.events:(v.call(this,t,u),t.size>=this._sizeLimit?t.events:(v.call(this,t,l),this._sizeLimit,t.events))}},{key:"isEmpty",value:function(t){return g.call(this,t)}},{key:"destroy",value:function(){this._secondInterval&&(clearInterval(this._secondInterval),this._secondInterval=0),this._storageTimeout&&(clearTimeout(this._storageTimeout),this._storageTimeout=0),this._rumId=null,this._events=null,this._isFirst=!1,this._config=c,this._hasConf=!1,this._delayCount=0,this._platformRum&&(this._platformRum=null)}},{key:"sizeof",value:function(t){if(!t)return 0;if("[object String]"===Object.prototype.toString.call(t))return d.call(this,t);if("[object ArrayBuffer]"===Object.prototype.toString.call(t))return t.byteLength;try{return d.call(this,JSON.stringify(t))}catch(t){}return 0}},{key:"timestamp",set:function(t){this._secondInterval&&(clearInterval(this._secondInterval),this._secondInterval=0),t<this._timestamp?this._delayCount=this._timestamp-t:this._timestamp=t,y.call(this)},get:function(){return this._timestamp}},{key:"storageSize",get:function(){return this._storageSize}},{key:"hasConfig",get:function(){return this._hasConf}},{key:"sizeLimit",set:function(t){t>0&&(this._sizeLimit=t)}},{key:"isFirst",get:function(){return this._rumId||_.call(this),!!this._isFirst&&(this._isFirst=!1,!0)}},{key:"rumId",get:function(){return this._rumId?this._rumId:_.call(this)}}]),t}();function _(){var t=function(t,e){var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=[];if(e=e||n.length,t)for(var r=0;r<t;r++)i[r]=n[0|Math.random()*e];else{var o=void 0;i[8]=i[13]=i[18]=i[23]="-",i[14]="4";for(var s=0;s<36;s++)i[s]||(o=0|16*Math.random(),i[s]=n[19==s?3&o|8:o]);for(var a=Date.now().toString(),u=0;u<a.length;u++)i[u]=a.charAt(u)}return i.join("")}.call(this,0,16),e=this._platformRum.getItem(this._rum_id_storage);return e.rid?t=e.rid.toString():(this._isFirst=!0,this._platformRum.setItem(this._rum_id_storage,{rid:t})),this._rumId=t}function f(t){return this._events[t]||(this._events[t]={}),this._events[t]}function m(t,e){this._events[t]=e}function g(t){return!t||(void 0==t||("[object String]"===Object.prototype.toString.call(t)?""==t:"[object Array]"===Object.prototype.toString.call(t)?0==t.length:"[object Object]"===Object.prototype.toString.call(t)&&0==Object.getOwnPropertyNames(t).length))}function v(t,e){var n=f.call(this,e);if(!g.call(this,n)){var i=f.call(this,o);for(var r in this._rumId||_.call(this),n){for(;n[r].length&&t.size<this._sizeLimit;){var s=n[r].shift();for(var a in s.ts||(s.ts=this._timestamp),s.rid||(s.rid=this._rumId),s)"[object Boolean]"!==Object.prototype.toString.call(s[a])&&(s[a]&&0!=s[a].length||delete s[a]);t.events.push(s),i[s.eid]=s,t.size+=d.call(this,JSON.stringify(s))}if(0==n[r].length&&delete n[r],t.size>=this._sizeLimit)break}m.call(this,e,n)}}function d(t){for(var e=0,n=null,i=0;i<t.length;i++)e+=(n=t.charCodeAt(i))<=127?1:n<=2047?2:n<=65535?3:4;return e}function p(t){return this._config[1]&&this._config[1].indexOf(t)>-1?a:this._config[2]&&this._config[2].indexOf(t)>-1?u:this._config[3]&&this._config[3].indexOf(t)>-1?l:this._hasConf?null:s}function y(){if(this._timestamp&&!this._secondInterval){var t=this;this._secondInterval=setInterval(function(){t._delayCount?t._delayCount--:t._timestamp++},1e3)}}t.exports=h},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._endpoint=e,this._targetEndpoint=null}return i(t,[{key:"buildProxyData",value:function(t){return JSON.stringify({endpoint:this._targetEndpoint,data:t})}},{key:"endpoint",get:function(){return this._endpoint}},{key:"targetEndpoint",get:function(){return this._targetEndpoint},set:function(t){this._targetEndpoint=t}}]),t}();t.exports=r},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._model="",this._brand="",this._pixelRatio=0,this._screenWidth=0,this._screenHeight=0,this._language="",this._version="",this._system="",this._platform="";this._network="",this._isActive=!0,this._wx_api={},this._hook=function(){var t={};if(this._wx_api=wx||{},"undefined"==typeof wx)return t;for(var e in this._wx_api)t[e]=this._wx_api[e];return t.prototype=this._wx_api.prototype,t}.call(this);try{var n=this._hook.getSystemInfoSync();this._model=n.model,this._brand=n.brand,this._pixelRatio=n.pixelRatio,this._screenWidth=n.windowWidth,this._screenHeight=n.windowHeight,this._language=n.language,this._version=n.version,this._system=n.system,this._platform=n.platform,this._storageInfo=this._hook.getStorageInfoSync()}catch(t){}e&&0!=Object.getOwnPropertyNames(this._hook).length&&(wx=this._hook),function(){var t=this;this._wx_api.request&&(this._hook.request=function(e){var n={},i=o.call(t);for(var r in e)n[r]=e[r];return n.complete=function(n){var r=o.call(t)-i;e.complete&&e.complete(n),t.emit("http_hook",{req:e,res:n,latency:r})},t._wx_api.request(n)})}.call(this)}return i(t,[{key:"setItem",value:function(t,e){var n=null;try{n=JSON.stringify(e)}catch(t){n=e}try{this._hook.setStorageSync(t,n)}catch(t){return!1}return!0}},{key:"getItem",value:function(t){var e=null,n=null;try{n=this._hook.getStorageSync(t)}catch(t){}n||(n={});try{e=JSON.parse(n)}catch(t){e=n}return e}},{key:"removeItem",value:function(t){if(this._storageInfo&&-1!=this._storageInfo.keys.indexOf(t))try{return this._hook.removeStorageSync(t),!0}catch(t){}return!1}},{key:"httpRequest",value:function(t,e){(function(t,e){if(!this._hook.request)return void(e&&e(new Error("`wx.request` is undefined!"),null));this._hook.request({url:t,success:function(t){e&&e(null,t.data)}})}).call(this,t,e)}},{key:"addSelfListener",value:function(t){(function(){var t=this;this._hook.onHide&&this._hook.onHide(function(){t._isActive&&(t._isActive=!1,t.emit("visible_change",!1))});this._hook.onShow&&this._hook.onShow(function(){t._isActive||(t._isActive=!0,t.emit("visible_change",!0))})}).call(this),function(){var t=this;this._hook.getNetworkType&&this._hook.getNetworkType({success:function(e){t._network=e.networkType,t.emit("network")}});this._hook.onNetworkStatusChange&&this._hook.onNetworkStatusChange(function(e){var n=t._network;e.isConnected?t._network=e.networkType:t._network="",t.emit("network_change",{ss:n,cs:t._network})})}.call(this),function(){var t=this;this._hook.onMemoryWarning&&this._hook.onMemoryWarning(function(e){t.emit("memory_warning",e)})}.call(this),function(){var t=this;this._hook.onError&&this._hook.onError(function(e){t.emit("running_error",e)})}.call(this),function(){var t=this;if(this._hook.getUpdateManager){var e=this._hook.getUpdateManager();e.onCheckForUpdate(function(e){t.emit("check_update",e)}),e.onUpdateReady(function(){t.emit("check_update",{status:"ready"})}),e.onUpdateFailed(function(){t.emit("check_update",{status:"failed"})})}}.call(this),function(){var t=this;this._hook.getSetting&&this._hook.getSetting({success:function(e){var n=e.authSetting;t.emit("auth_setting",n),n["scope.userInfo"]&&function(){var t=this;this._hook.getUserInfo&&this._hook.getUserInfo({withCredentials:!1,success:function(e){t.emit("user_info",e.userInfo)}})}.call(t),n["scope.userLocation"]&&function(){var t=this;this._hook.getLocation&&this._hook.getLocation({type:"gcj02",altitude:!0,success:function(e){t.emit("location_gcj02",e)}})}.call(t)}})}.call(this);var e=null;try{e=this._hook.getLaunchOptionsSync()}catch(t){}e&&t&&t(e),function(){var t=this;this._hook.getSystemInfo&&this._hook.getSystemInfo({success:function(e){t.emit("system_info",e)}})}.call(this)}},{key:"lang",get:function(){return this._language}},{key:"manu",get:function(){return this._brand}},{key:"model",get:function(){return this._model}},{key:"os",get:function(){return this._system}},{key:"osv",get:function(){return this._system}},{key:"network",get:function(){return this._network}},{key:"isMobile",get:function(){return!0}},{key:"screenheight",get:function(){return this._screenHeight}},{key:"screenwidth",get:function(){return this._screenWidth}},{key:"carrier",get:function(){return null}},{key:"from",get:function(){return"wechat"}},{key:"tickNow",get:function(){return o.call(this)}}]),t}();function o(){return Date.now()}t.exports=r},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=n(3),o=n(2),s=n(0),a=n(1),u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),fpnn.FPEvent.assign(this),this._pid=e.pid,this._token=e.token,this._ping_eid=0,this._ping_latency=0,this._write_count=0,this._midCount=0,this._sendInterval=0,this._pingInterval=0,this._configVersion=0,this._platformImpl=e.platformImpl,this._platformRum=e.platformRum||new a,fpnn.FPEvent.assign(this._platformRum),this._uid=e.uid&&e.uid.toString()||"",this._appv=e.appv||"",this._debug=e.debug||!1,this._ssl=e.ssl||!0,this._session=0,this._sessionTimestamp=0,this._proxy=null,this._baseClient=null,this._rumEvent=new o(this._pid,this._platformRum,this._debug)}return i(t,[{key:"destroy",value:function(){this._midCount=0,this._ping_eid=0,this._write_count=0,this._sendInterval&&(clearInterval(this._sendInterval),this._sendInterval=0),this._pingInterval&&(clearInterval(this._pingInterval),this._pingInterval=0),this._platformImpl&&this._platformImpl.removeEvent(),this._rumEvent&&this._rumEvent.destroy(),this.removeEvent(),this._baseClient&&(this._baseClient.destroy(),this._baseClient=null)}},{key:"connect",value:function(t,e){if(null==this._baseClient){e&&this._rumEvent.clearStorage(),t=function(t){if(this._proxy)return t;var e="ws://";this._ssl&&(e="wss://");return e+t+"/service/websocket"}.call(this,t),this._debug&&console.log("[RUM] init: ",t),this._ssl&&(this._proxy=new r(t)),c.call(this),function(){var t=this;this._platformRum.on("visible_change",function(e){l.call(t,e?"fg":"bg",{})}),this._platformRum.on("network_change",function(e){l.call(t,"nwswitch",{sstate:e.ss,cstate:e.cs})}),this._platformRum.on("network",function(){_.call(t,"nw",{nw:t._platformRum.network})}),this._platformRum.on("memory_warning",function(e){l.call(t,"warn",{type:"wx_memory_warn",level:e.level})}),this._platformRum.on("running_error",function(e){l.call(t,"error",{type:"wx_running_error",message:e.message,stack:e.stack})}),this._platformRum.on("check_update",function(e){l.call(t,"info",{type:"wx_check_update",hasUpdate:e.hasUpdate,status:e.status})}),this._platformRum.on("auth_setting",function(e){l.call(t,"info",{type:"wx_auth_setting",settings:e})}),this._platformRum.on("user_info",function(e){l.call(t,"info",{type:"wx_user_info",userInfo:e})}),this._platformRum.on("location_gcj02",function(e){l.call(t,"info",{type:"wx_location_gcj02",location:e})}),this._platformRum.on("system_info",function(e){l.call(t,"info",{type:"wx_system_info",systemInfo:e})}),this._platformRum.on("http_hook",function(e){var n={cstate:t._platformRum.network};e&&(e.req&&(n.url=e.req.url,n.method=e.req.method||"GET",n.reqsize=t._rumEvent.sizeof(e.req.data)),e.res&&(n.status=e.res.statusCode,n.attrs={errMsg:e.res.errMsg},n.respsize=t._rumEvent.sizeof(e.res.data)),n.latency=e.latency||0),t._debug&&console.log("[RUM] http hook: ",n),(!n.status||n.status>=300||n.latency>500)&&l.call(t,"http",n)}),this._platformRum.addSelfListener(function(e){l.call(t,"info",{type:"wx_launch_options",options:e}),t.customEvent("launch_options",e)})}.call(this),this._baseClient=new fpnn.FPClient({endpoint:t,autoReconnect:!0,connectionTimeout:s.SENT_TIMEOUT,proxy:this._proxy,platformImpl:this._platformImpl});var n=this;this._baseClient.on("connect",function(){if(n._debug&&console.log("[RUM] connect on rum agent!"),n._sessionTimestamp){var t=n._platformRum.isMobile?s.RESET_OPENEVENT_INTERVAL_MOBILE:s.RESET_OPENEVENT_INTERVAL;Date.now()-n._sessionTimestamp>=t&&c.call(n)}n.emit("ready"),function(){h.call(this);var t=this;if(this._pingInterval)return;this._pingInterval=setInterval(function(){h.call(t)},s.PING_INTERVAL)}.call(n),function(){if(this._sendInterval)return;var t=this;this._sendInterval=setInterval(function(){var e=t._rumEvent.getSentEvents();e.length&&(t._debug&&console.log("[rum] will be sent! ",e),function(t){var e=g.call(this),n={sign:m.call(this,e),salt:e,pid:this._pid,events:t},i={flag:0,method:"adds",payload:JSON.stringify(n)},r=this;d.call(this,this._baseClient,i,function(e,n){if(r._rumEvent.removeFromCache(t),e)return r.emit("error",e),void r._rumEvent.writeEvents(t)},s.SENT_TIMEOUT)}.call(t,e))},1e3)}.call(n)}),this._baseClient.on("close",function(){n._debug&&console.log("[RUM] close from rum agent!"),function(){this._pingInterval&&(clearInterval(this._pingInterval),this._pingInterval=0)}.call(n),function(){this._sendInterval&&(clearInterval(this._sendInterval),this._sendInterval=0)}.call(n),n.emit("close")}),this._baseClient.on("error",function(t){n._debug&&console.log("[RUM] error: ",t),n.emit("error",t)}),this._baseClient.connect()}else this.emit("error",new Error("has been init!"))}},{key:"customEvent",value:function(t,e,n){var i={attrs:e||{}};l.call(this,t,i,n)}},{key:"session",get:function(){return this._session}},{key:"rumId",get:function(){return this._rumEvent.rumId}},{key:"uid",set:function(t){this._uid=t&&t.toString(),this._uid&&_.call(this,"uid",{uid:this._uid})}}]),t}();function l(t,e,n){e.ev=t,n=n||!1,e.eid||(e.eid=f.call(this),this._write_count++),e.pid||(e.pid=this._pid||0),e.sid||(e.sid=this._session||0),e.uid||(e.uid=this._uid),e.rid||(e.rid=this._rumEvent.rumId),e.ts||(e.ts=this._rumEvent.timestamp),this._debug&&console.log("[RUM] write event: ",n,e),this._rumEvent.writeEvent(e,n)}function c(){this._session=f.call(this),this._sessionTimestamp=Date.now();var t={sw:this._platformRum.screenwidth||0,sh:this._platformRum.screenheight||0};t.manu=this._platformRum.manu||"",t.model=this._platformRum.model||"",t.os=this._platformRum.os||"",t.osv=this._platformRum.osv||"",t.nw=this._platformRum.network||"",t.carrier=this._platformRum.carrier||"",t.lang=this._platformRum.lang||"",t.from=this._platformRum.from||"",t.appv=this._appv||"",t.v=s.VERSION,t.first=this._rumEvent.isFirst,l.call(this,"open",t,!0)}function h(){this._debug&&console.log("[RUM] ping...");var t=this._ping_eid,e=this._write_count;this._write_count=0,this._ping_eid=f.call(this);var n=g.call(this),i={pid:this._pid,sign:m.call(this,n),salt:n};i.uid=this._uid,i.rid=this._rumEvent.rumId,i.sid=this._session||0,i.cv=this._configVersion||0,i.pt=this._ping_latency||0,i.ss=this._rumEvent.storageSize||0,i.wc=e,i.feid=t,i.teid=this._ping_eid;var r={flag:0,method:"ping",payload:JSON.stringify(i)},o=this,a=this._platformRum.tickNow;d.call(this,this._baseClient,r,function(t,e){o._ping_latency=o._platformRum.tickNow-a,t?o.emit("error",t):(o._rumEvent.timestamp=+e.ts,o._rumEvent.sizeLimit=+e.bw,o._debug&&console.log("[RUM] ping:",o._configVersion,e),(o._configVersion!=+e.cv||0==+e.cv&&!o._rumEvent.hasConfig)&&(o._configVersion=+e.cv,function(){this._debug&&console.log("[RUM] load config...");var t=g.call(this),e={pid:this._pid,sign:m.call(this,t),salt:t};e.uid=this._uid,e.rid=this._rumEvent.rumId,e.lang=this._platformRum.lang||"",e.manu=this._platformRum.manu||"",e.model=this._platformRum.model||"",e.os=this._platformRum.os||"",e.osv=this._platformRum.osv||"",e.nw=this._platformRum.network||"",e.carrier=this._platformRum.carrier||"",e.from=this._platformRum.from||"",e.appv=this._appv||"";var n={flag:0,method:"getconfig",payload:JSON.stringify(e)},i=this;d.call(this,this._baseClient,n,function(t,e){if(t)return i._configversion=0,void i.emit("error",t);i._debug&&console.log("[RUM] load config:",e),i._rumEvent.updateConfig(e.events)},s.SENT_TIMEOUT)}.call(o)))},s.PING_INTERVAL)}function _(t,e){e.type=t&&t.toString(),l.call(this,"append",e,"uid"==e.type)}function f(){return++this._midCount>=999&&(this._midCount=0),+(Date.now().toString()+this._midCount)}function m(t){return md5(this._pid+":"+this._token+":"+t).toUpperCase()}function g(){return+Date.now().toString()}function v(t,e){return e?e instanceof Error?e:t&&e.code&&e.ex?new Error("code: "+e.code+", ex: "+e.ex):null:new Error("data is null!")}function d(t,e,n,i){var r=this;t?t.sendQuest(e,function(t){if(n){var e=null,i=!1;if(t.payload){var o=JSON.parse(t.payload);return 2==t.mtype&&(i=0!=t.ss),(e=v.call(r,i,o))?void n(e,null):void n(null,o)}(e=v.call(r,i,t))?n(t,null):n(null,t)}},i):n&&n(new Error("client is null!"),null)}t.exports=u},function(t,e,n){"use strict";var i=n(5),r=n(0),o=n(2),s=n(3),a=n(1),u=n(4);t.exports={RUMClient:i,RUMConfig:r,RUMEvent:o,RUMProxy:s,BrowserRum:a,WechatRum:u}}])});