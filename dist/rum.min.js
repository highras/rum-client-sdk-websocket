!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.rum=e():t.rum=e()}(window,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=6)}([function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return n(t,null,[{key:"VERSION",get:function(){return"1.0.13"}},{key:"PING_INTERVAL",get:function(){return 2e4}},{key:"SENT_TIMEOUT",get:function(){return 2e4}},{key:"RESET_OPENEVENT_INTERVAL",get:function(){return 18e5}},{key:"RESET_OPENEVENT_INTERVAL_MOBILE",get:function(){return 6e4}},{key:"EVENT_QUEUE_LIMIT",get:function(){return 1e3}},{key:"STORAGE_SIZE_LIMIT",get:function(){return 2097152}},{key:"LOCAL_STORAGE_DELAY",get:function(){return 1e3}},{key:"SENT_SIZE_LIMIT",get:function(){return 15360}}]),t}();t.exports=s},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._ua=UAParser()}return n(t,[{key:"setItem",value:function(t,e){var i=null;try{i=JSON.stringify(e)}catch(t){i=e}try{localStorage.setItem(t,i)}catch(t){return!1}return!0}},{key:"getItem",value:function(t){var e=null,i=null;try{i=localStorage.getItem(t)}catch(t){}i||(i={});try{e=JSON.parse(i)}catch(t){e=i}return e}},{key:"removeItem",value:function(t){if(localStorage&&localStorage.hasOwnProperty(t))try{return localStorage.removeItem(t),!0}catch(t){}return!1}},{key:"httpRequest",value:function(t,e){(function(t,e){var i=new XMLHttpRequest;i&&(i.open("GET",t,!0),i.onload=function(){var t=JSON.parse(i.responseText);4==i.readyState&&"200"==i.status&&e&&e(null,t)},i.send(null))}).call(this,t,e)}},{key:"addSelfListener",value:function(){(function(){var t=this,e=void 0,i=void 0;void 0!==document.hidden?(e="hidden",i="visibilitychange","visibilityState"):void 0!==document.mozHidden?(e="mozHidden",i="mozvisibilitychange","mozVisibilityState"):void 0!==document.msHidden?(e="msHidden",i="msvisibilitychange","msVisibilityState"):void 0!==document.webkitHidden&&(e="webkitHidden",i="webkitvisibilitychange","webkitVisibilityState");document.addEventListener(i,function(){t.emit("visible_change",!document[e])},!1)}).call(this)}},{key:"lang",get:function(){return navigator.language}},{key:"manu",get:function(){return this._ua.device.vendor||navigator.vendor}},{key:"model",get:function(){return this._ua.device.model||this._ua.browser.name}},{key:"os",get:function(){return this._ua.os.name}},{key:"osv",get:function(){return this._ua.os.version}},{key:"network",get:function(){return navigator.connection&&navigator.connection.effectiveType}},{key:"isMobile",get:function(){return"mobile"===this._ua.device.type}},{key:"screenheight",get:function(){return screen.height}},{key:"screenwidth",get:function(){return screen.width}},{key:"carrier",get:function(){return null}},{key:"from",get:function(){return null}},{key:"tickNow",get:function(){return function(){return Date.now()}.call(this)}}]),t}();t.exports=s},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s=i(0),r="event_cache",o="event_map_0",a="event_map_1",u="event_map_2",l="event_map_3",c={1:["crash","error","nwswitch","open","warn","append"]},h=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._rumId=null,this._events=null,this._isFirst=!1,this._config=c,this._hasConf=!1,this._debug=n,this._timestamp=0,this._secondInterval=0,this._delayCount=0,this._platformRum=i,this._rum_id_storage="rum_rid_"+e,this._rum_events_storage="rum_events_"+e,this._storageSize=0,this._storageTimeout=0,this._sizeLimit=s.SENT_SIZE_LIMIT,function(){this._events=this._platformRum.getItem(this._rum_events_storage),function t(){var e=this;this._storageSize=v.call(this,JSON.stringify(this._events));var i=s.LOCAL_STORAGE_DELAY*Math.ceil(this._storageSize/this._sizeLimit);this._storageSize>s.STORAGE_SIZE_LIMIT?this._platformRum.setItem(this._rum_events_storage,{}):this._platformRum.setItem(this._rum_events_storage,this._events);this._storageTimeout&&(clearTimeout(this._storageTimeout),this._storageTimeout=0);this._storageTimeout=setTimeout(function(){t.call(e)},i)}.call(this)}.call(this),y.call(this)}return n(t,[{key:"updateConfig",value:function(t){this._config=t,this._hasConf=!0;var e=f.call(this,o);for(var i in e){var n=d.call(this,i);if(n){var s=f.call(this,n);s[i]?s[i]=e[i].concat(s[i]):s[i]=e[i]}else this._debug&&console.log("[RUM] disable event & will be discard!",e[i]);delete e[i]}m.call(this,o,e);var a=f.call(this,r);if(!p.call(this,a))for(var u in a)this.writeEvent(a[u]);m.call(this,r,{})}},{key:"writeEvent",value:function(t,e){var i=t.ev,n=d.call(this,i);if(n){var r=f.call(this,n);r[i]||(r[i]=[]),r[i].length>=s.EVENT_QUEUE_LIMIT&&(this._debug&&console.log("[RUM] event(normal) queue limit & will be shift!",t),r[i].shift()),r[i].push(t),m.call(this,n,r)}else this._debug&&console.log("[RUM] disable event & will be discard!",i);e&&this._platformRum.setItem(this._rum_events_storage,this._events)}},{key:"writeEvents",value:function(t){for(var e in t)this.writeEvent(t[e])}},{key:"clearStorage",value:function(){this._events={},this._platformRum.setItem(this._rum_events_storage,{})}},{key:"removeFromCache",value:function(t){var e=f.call(this,r);for(var i in t)delete e[t[i].eid];m.call(this,r,e)}},{key:"getSentEvents",value:function(){var t={size:0,events:[]};return g.call(this,t,a),t.size>=this._sizeLimit?t.events:(g.call(this,t,u),t.size>=this._sizeLimit?t.events:(g.call(this,t,l),this._sizeLimit,t.events))}},{key:"isEmpty",value:function(t){return p.call(this,t)}},{key:"destroy",value:function(){this._secondInterval&&(clearInterval(this._secondInterval),this._secondInterval=0),this._storageTimeout&&(clearTimeout(this._storageTimeout),this._storageTimeout=0),this._rumId=null,this._events=null,this._isFirst=!1,this._config=c,this._hasConf=!1,this._delayCount=0,this._platformRum&&(this._platformRum=null)}},{key:"sizeof",value:function(t){if(!t)return 0;if("[object String]"===Object.prototype.toString.call(t))return v.call(this,t);if("[object ArrayBuffer]"===Object.prototype.toString.call(t))return t.byteLength;try{return v.call(this,JSON.stringify(t))}catch(t){}return 0}},{key:"timestamp",set:function(t){this._secondInterval&&(clearInterval(this._secondInterval),this._secondInterval=0),t<this._timestamp?this._delayCount=this._timestamp-t:this._timestamp=t,y.call(this)},get:function(){return this._timestamp}},{key:"storageSize",get:function(){return this._storageSize}},{key:"hasConfig",get:function(){return this._hasConf}},{key:"sizeLimit",set:function(t){t>0&&(this._sizeLimit=t)}},{key:"isFirst",get:function(){return this._rumId||_.call(this),!!this._isFirst&&(this._isFirst=!1,!0)}},{key:"rumId",get:function(){return this._rumId?this._rumId:_.call(this)}}]),t}();function _(){var t=function(t,e){var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[];if(e=e||i.length,t)for(var s=0;s<t;s++)n[s]=i[0|Math.random()*e];else{var r=void 0;n[8]=n[13]=n[18]=n[23]="-",n[14]="4";for(var o=0;o<36;o++)n[o]||(r=0|16*Math.random(),n[o]=i[19==o?3&r|8:r]);for(var a=Date.now().toString(),u=0;u<a.length;u++)n[u]=a.charAt(u)}return n.join("")}.call(this,0,16),e=this._platformRum.getItem(this._rum_id_storage);return e.rid?t=e.rid.toString():(this._isFirst=!0,this._platformRum.setItem(this._rum_id_storage,{rid:t})),this._rumId=t}function f(t){return this._events[t]||(this._events[t]={}),this._events[t]}function m(t,e){this._events[t]=e}function p(t){return!t||(void 0==t||("[object String]"===Object.prototype.toString.call(t)?""==t:"[object Array]"===Object.prototype.toString.call(t)?0==t.length:"[object Object]"===Object.prototype.toString.call(t)&&0==Object.getOwnPropertyNames(t).length))}function g(t,e){var i=f.call(this,e);if(!p.call(this,i)){var n=f.call(this,r);for(var s in this._rumId||_.call(this),i){for(;i[s].length&&t.size<this._sizeLimit;){var o=i[s].shift();for(var a in o.ts||(o.ts=this._timestamp),o.rid||(o.rid=this._rumId),o)"[object Boolean]"!==Object.prototype.toString.call(o[a])&&(o[a]&&0!=o[a].length||delete o[a]);t.events.push(o),n[o.eid]=o,t.size+=v.call(this,JSON.stringify(o))}if(0==i[s].length&&delete i[s],t.size>=this._sizeLimit)break}m.call(this,e,i)}}function v(t){for(var e=0,i=null,n=0;n<t.length;n++)e+=(i=t.charCodeAt(n))<=127?1:i<=2047?2:i<=65535?3:4;return e}function d(t){return this._config[1]&&this._config[1].indexOf(t)>-1?a:this._config[2]&&this._config[2].indexOf(t)>-1?u:this._config[3]&&this._config[3].indexOf(t)>-1?l:this._hasConf?null:o}function y(){if(this._timestamp&&!this._secondInterval){var t=this;this._secondInterval=setInterval(function(){t._delayCount?t._delayCount--:t._timestamp++},1e3)}}t.exports=h},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._endpoint=e,this._targetEndpoint=null}return n(t,[{key:"buildProxyData",value:function(t){return JSON.stringify({endpoint:this._targetEndpoint,data:t})}},{key:"endpoint",get:function(){return this._endpoint}},{key:"targetEndpoint",get:function(){return this._targetEndpoint},set:function(t){this._targetEndpoint=t}}]),t}();t.exports=s},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._model="",this._brand="",this._pixelRatio=0,this._screenWidth=0,this._screenHeight=0,this._language="",this._version="",this._system="",this._platform="";this._network="",this._isActive=!0,this._wx_api={},this._hook=function(){var t={};if(this._wx_api=wx||{},"undefined"==typeof wx)return t;for(var e in this._wx_api)t[e]=this._wx_api[e];return t.prototype=this._wx_api.prototype,t}.call(this);try{var i=this._hook.getSystemInfoSync();this._model=i.model,this._brand=i.brand,this._pixelRatio=i.pixelRatio,this._screenWidth=i.windowWidth,this._screenHeight=i.windowHeight,this._language=i.language,this._version=i.version,this._system=i.system,this._platform=i.platform,this._storageInfo=this._hook.getStorageInfoSync()}catch(t){}e&&0!=Object.getOwnPropertyNames(this._hook).length&&(wx=this._hook),function(){var t=this;this._wx_api.request&&(this._hook.request=function(e){var i={},n=r.call(t);for(var s in e)i[s]=e[s];return i.complete=function(i){var s=r.call(t)-n;e.complete&&e.complete(i),t.emit("http_hook",{req:e,res:i,latency:s})},t._wx_api.request(i)})}.call(this),function(){var t=this;this._wx_api.onShareAppMessage&&(this._hook.onShareAppMessage=function(e){t._wx_api.onShareAppMessage(function(i){var n=e&&e(i)||{},s={title:n.title,imageUrl:n.imageUrl,query:n.query};return{title:n.title,imageUrl:n.imageUrl,query:n.query,success:function(e){t.emit("share_hook",{type:"wx_onShareAppMessage_success",res:i,req:s}),n.success&&n.success(e)},fail:function(e){t.emit("share_hook",{type:"wx_onShareAppMessage_fail",res:i,req:s}),n.fail&&n.fail(e)},complete:function(t){n.complete&&n.complete(t)}}})});this._wx_api.shareAppMessage&&(this._hook.shareAppMessage=function(e){var i={title:e.title,imageUrl:e.imageUrl,query:e.query},n={title:e.title,imageUrl:e.imageUrl,query:e.query,success:function(n){t.emit("share_hook",{type:"wx_shareAppMessage_success",res:n,req:i}),e.success&&e.success(n)},fail:function(n){t.emit("share_hook",{type:"wx_shareAppMessage_fail",res:n,req:i}),e.fail&&e.fail(n)},complete:function(t){e.complete&&e.complete(t)}};t._wx_api.shareAppMessage(n)})}.call(this)}return n(t,[{key:"setItem",value:function(t,e){var i=null;try{i=JSON.stringify(e)}catch(t){i=e}try{this._hook.setStorageSync(t,i)}catch(t){return!1}return!0}},{key:"getItem",value:function(t){var e=null,i=null;try{i=this._hook.getStorageSync(t)}catch(t){}i||(i={});try{e=JSON.parse(i)}catch(t){e=i}return e}},{key:"removeItem",value:function(t){if(this._storageInfo&&-1!=this._storageInfo.keys.indexOf(t))try{return this._hook.removeStorageSync(t),!0}catch(t){}return!1}},{key:"httpRequest",value:function(t,e){(function(t,e){if(!this._hook.request)return void(e&&e(new Error("`wx.request` is undefined!"),null));this._hook.request({url:t,success:function(t){e&&e(null,t.data)}})}).call(this,t,e)}},{key:"addSelfListener",value:function(t){(function(){var t=this;this._hook.onHide&&this._hook.onHide(function(){t._isActive=!1,t.emit("visible_change",!1)});this._hook.onShow&&this._hook.onShow(function(e){t._isActive=!0,t.emit("visible_change",!0,e)})}).call(this),function(){var t=this;this._hook.getNetworkType&&this._hook.getNetworkType({success:function(e){t._network=e.networkType,t.emit("network")}});this._hook.onNetworkStatusChange&&this._hook.onNetworkStatusChange(function(e){var i=t._network;e.isConnected?t._network=e.networkType:t._network="",t.emit("network_change",{ss:i,cs:t._network})})}.call(this),function(){var t=this;this._hook.onMemoryWarning&&this._hook.onMemoryWarning(function(e){t.emit("memory_warning",e)})}.call(this),function(){var t=this;this._hook.onError&&this._hook.onError(function(e){t.emit("running_error",e)})}.call(this),function(){var t=this;if(this._hook.getUpdateManager){var e=this._hook.getUpdateManager();e.onCheckForUpdate(function(e){t.emit("check_update",e)}),e.onUpdateReady(function(){t.emit("check_update",{status:"ready"})}),e.onUpdateFailed(function(){t.emit("check_update",{status:"failed"})})}}.call(this),function(){var t=this;this._hook.getSetting&&this._hook.getSetting({success:function(e){var i=e.authSetting;t.emit("auth_setting",i),i["scope.userInfo"]&&function(){var t=this;this._hook.getUserInfo&&this._hook.getUserInfo({withCredentials:!1,success:function(e){t.emit("user_info",e.userInfo)}})}.call(t),i["scope.userLocation"]&&function(){var t=this;this._hook.getLocation&&this._hook.getLocation({type:"gcj02",altitude:!0,success:function(e){t.emit("location_gcj02",e)}})}.call(t)}})}.call(this);var e=null;try{e=this._hook.getLaunchOptionsSync()}catch(t){}e&&t&&t(e),function(){var t=this;this._hook.getSystemInfo&&this._hook.getSystemInfo({success:function(e){t.emit("system_info",e)}})}.call(this)}},{key:"lang",get:function(){return this._language}},{key:"manu",get:function(){return this._brand}},{key:"model",get:function(){return this._model}},{key:"os",get:function(){return this._system}},{key:"osv",get:function(){return this._system}},{key:"network",get:function(){return this._network}},{key:"isMobile",get:function(){return!0}},{key:"screenheight",get:function(){return this._screenHeight}},{key:"screenwidth",get:function(){return this._screenWidth}},{key:"carrier",get:function(){return null}},{key:"from",get:function(){return"wechat"}},{key:"tickNow",get:function(){return r.call(this)}}]),t}();function r(){return Date.now()}t.exports=s},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s=i(3),r=i(2),o=i(0),a=i(1),u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),fpnn.FPEvent.assign(this),this._pid=e.pid,this._token=e.token,this._ping_eid=0,this._ping_latency=0,this._write_count=0,this._midCount=0,this._sendInterval=0,this._pingInterval=0,this._configVersion=0,this._platformImpl=e.platformImpl,this._platformRum=e.platformRum||new a,fpnn.FPEvent.assign(this._platformRum),this._uid=e.uid&&e.uid.toString()||"",this._appv=e.appv||"",this._debug=e.debug||!1,this._ssl=e.ssl||!0,this._md5=e.md5||null,this._session=0,this._sessionTimestamp=0,this._proxy=null,this._baseClient=null,this._rumEvent=new r(this._pid,this._platformRum,this._debug)}return n(t,[{key:"destroy",value:function(){this._midCount=0,this._ping_eid=0,this._write_count=0,this._sendInterval&&(clearInterval(this._sendInterval),this._sendInterval=0),this._pingInterval&&(clearInterval(this._pingInterval),this._pingInterval=0),this._platformImpl&&this._platformImpl.removeEvent(),this._rumEvent&&this._rumEvent.destroy(),this.removeEvent(),this._baseClient&&(this._baseClient.destroy(),this._baseClient=null)}},{key:"connect",value:function(t,e){if(null==this._baseClient){e&&this._rumEvent.clearStorage(),t=function(t){if(this._proxy)return t;var e="ws://";this._ssl&&(e="wss://");return e+t+"/service/websocket"}.call(this,t),this._debug&&console.log("[RUM] init: ",t),this._ssl&&(this._proxy=new s(t)),c.call(this),function(){var t=this;this._platformRum.on("visible_change",function(e,i){l.call(t,e?"fg":"bg",{}),i&&l.call(t,"info",{type:"wx_on_show",options:i})}),this._platformRum.on("network_change",function(e){l.call(t,"nwswitch",{sstate:e.ss,cstate:e.cs})}),this._platformRum.on("network",function(){_.call(t,"nw",{nw:t._platformRum.network})}),this._platformRum.on("memory_warning",function(e){l.call(t,"warn",{type:"wx_memory_warn",level:e.level})}),this._platformRum.on("running_error",function(e){l.call(t,"error",{type:"wx_running_error",message:e.message,stack:e.stack})}),this._platformRum.on("check_update",function(e){l.call(t,"info",{type:"wx_check_update",hasUpdate:e.hasUpdate,status:e.status})}),this._platformRum.on("auth_setting",function(e){l.call(t,"info",{type:"wx_auth_setting",settings:e})}),this._platformRum.on("user_info",function(e){l.call(t,"info",{type:"wx_user_info",userInfo:e})}),this._platformRum.on("location_gcj02",function(e){l.call(t,"info",{type:"wx_location_gcj02",location:e})}),this._platformRum.on("system_info",function(e){l.call(t,"info",{type:"wx_system_info",systemInfo:e})}),this._platformRum.on("http_hook",function(e){var i={cstate:t._platformRum.network};e&&(e.req&&(i.url=e.req.url,i.method=e.req.method||"GET",i.reqsize=t._rumEvent.sizeof(e.req.data)),e.res&&(i.status=e.res.statusCode,i.attrs={errMsg:e.res.errMsg},i.respsize=t._rumEvent.sizeof(e.res.data)),i.latency=e.latency||0),t._debug&&console.log("[RUM] http hook: ",i),(!i.status||i.status>=300||i.latency>500)&&l.call(t,"http",i)}),this._platformRum.on("share_hook",function(e){l.call(t,"info",e)}),this._platformRum.addSelfListener(function(e){l.call(t,"info",{type:"wx_launch_options",options:e}),t.customEvent("launch_options",e)})}.call(this),this._baseClient=new fpnn.FPClient({endpoint:t,autoReconnect:!0,connectionTimeout:o.SENT_TIMEOUT,proxy:this._proxy,platformImpl:this._platformImpl});var i=this;this._baseClient.on("connect",function(){if(i._debug&&console.log("[RUM] connect on rum agent!"),i._sessionTimestamp){var t=i._platformRum.isMobile?o.RESET_OPENEVENT_INTERVAL_MOBILE:o.RESET_OPENEVENT_INTERVAL;Date.now()-i._sessionTimestamp>=t&&c.call(i)}i.emit("ready"),function(){h.call(this);var t=this;if(this._pingInterval)return;this._pingInterval=setInterval(function(){h.call(t)},o.PING_INTERVAL)}.call(i),function(){if(this._sendInterval)return;var t=this;this._sendInterval=setInterval(function(){var e=t._rumEvent.getSentEvents();e.length&&(t._debug&&console.log("[RUM] will be sent! ",e),function(t){var e=p.call(this),i={sign:m.call(this,e),salt:e,pid:this._pid,events:t},n={flag:0,method:"adds",payload:JSON.stringify(i)},s=this;v.call(this,this._baseClient,n,function(e,i){if(s._rumEvent.removeFromCache(t),e)return s.emit("error",e),void s._rumEvent.writeEvents(t)},o.SENT_TIMEOUT)}.call(t,e))},1e3)}.call(i)}),this._baseClient.on("close",function(){i._debug&&console.log("[RUM] close from rum agent!"),function(){this._pingInterval&&(clearInterval(this._pingInterval),this._pingInterval=0)}.call(i),function(){this._sendInterval&&(clearInterval(this._sendInterval),this._sendInterval=0)}.call(i),i.emit("close")}),this._baseClient.on("error",function(t){i._debug&&console.log("[RUM] error: ",t),i.emit("error",t)}),this._baseClient.connect()}else this.emit("error",new Error("has been init!"))}},{key:"customEvent",value:function(t,e,i){var n={attrs:e||{}};l.call(this,t,n,i)}},{key:"session",get:function(){return this._session}},{key:"rumId",get:function(){return this._rumEvent.rumId}},{key:"uid",set:function(t){this._uid=t&&t.toString(),this._uid&&_.call(this,"uid",{uid:this._uid})}}]),t}();function l(t,e,i){e.ev=t,i=i||!1,e.eid||(e.eid=f.call(this),this._write_count++),e.pid||(e.pid=this._pid||0),e.sid||(e.sid=this._session||0),e.uid||(e.uid=this._uid),e.rid||(e.rid=this._rumEvent.rumId),e.ts||(e.ts=this._rumEvent.timestamp),this._debug&&console.log("[RUM] write event: ",i,e),this._rumEvent.writeEvent(e,i)}function c(){this._session=f.call(this),this._sessionTimestamp=Date.now();var t={sw:this._platformRum.screenwidth||0,sh:this._platformRum.screenheight||0};t.manu=this._platformRum.manu||"",t.model=this._platformRum.model||"",t.os=this._platformRum.os||"",t.osv=this._platformRum.osv||"",t.nw=this._platformRum.network||"",t.carrier=this._platformRum.carrier||"",t.lang=this._platformRum.lang||"",t.from=this._platformRum.from||"",t.appv=this._appv||"",t.v=o.VERSION,t.first=this._rumEvent.isFirst,l.call(this,"open",t,!0)}function h(){this._debug&&console.log("[RUM] ping...");var t=this._ping_eid,e=this._write_count;this._write_count=0,this._ping_eid=f.call(this);var i=p.call(this),n={pid:this._pid,sign:m.call(this,i),salt:i};n.uid=this._uid,n.rid=this._rumEvent.rumId,n.sid=this._session||0,n.cv=this._configVersion||0,n.pt=this._ping_latency||0,n.ss=this._rumEvent.storageSize||0,n.wc=e,n.feid=t,n.teid=this._ping_eid;var s={flag:0,method:"ping",payload:JSON.stringify(n)},r=this,a=this._platformRum.tickNow;v.call(this,this._baseClient,s,function(t,e){r._ping_latency=r._platformRum.tickNow-a,t?r.emit("error",t):(r._rumEvent.timestamp=+e.ts,r._rumEvent.sizeLimit=+e.bw,r._debug&&console.log("[RUM] ping:",r._configVersion,e),(r._configVersion!=+e.cv||0==+e.cv&&!r._rumEvent.hasConfig)&&(r._configVersion=+e.cv,function(){this._debug&&console.log("[RUM] load config...");var t=p.call(this),e={pid:this._pid,sign:m.call(this,t),salt:t};e.uid=this._uid,e.rid=this._rumEvent.rumId,e.lang=this._platformRum.lang||"",e.manu=this._platformRum.manu||"",e.model=this._platformRum.model||"",e.os=this._platformRum.os||"",e.osv=this._platformRum.osv||"",e.nw=this._platformRum.network||"",e.carrier=this._platformRum.carrier||"",e.from=this._platformRum.from||"",e.appv=this._appv||"";var i={flag:0,method:"getconfig",payload:JSON.stringify(e)},n=this;v.call(this,this._baseClient,i,function(t,e){if(t)return n._configversion=0,void n.emit("error",t);n._debug&&console.log("[RUM] load config:",e),n._rumEvent.updateConfig(e.events)},o.SENT_TIMEOUT)}.call(r)))},o.PING_INTERVAL)}function _(t,e){e.type=t&&t.toString(),l.call(this,"append",e,"uid"==e.type)}function f(){return++this._midCount>=999&&(this._midCount=0),+(Date.now().toString()+this._midCount)}function m(t){return function(t){if(this._md5)return this._md5(t).toUpperCase();return md5(t).toUpperCase()}.call(this,this._pid+":"+this._token+":"+t)}function p(){return+Date.now().toString()}function g(t,e){return e?e instanceof Error?e:t&&e.code&&e.ex?new Error("code: "+e.code+", ex: "+e.ex):null:new Error("data is null!")}function v(t,e,i,n){var s=this;t?t.sendQuest(e,function(t){if(i){var e=null,n=!1;if(t.payload){var r=JSON.parse(t.payload);return 2==t.mtype&&(n=0!=t.ss),(e=g.call(s,n,r))?void i(e,null):void i(null,r)}(e=g.call(s,n,t))?i(t,null):i(null,t)}},n):i&&i(new Error("client is null!"),null)}t.exports=u},function(t,e,i){"use strict";var n=i(5),s=i(0),r=i(2),o=i(3),a=i(1),u=i(4);t.exports={RUMClient:n,RUMConfig:s,RUMEvent:r,RUMProxy:o,BrowserRum:a,WechatRum:u}}])});